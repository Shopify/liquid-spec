{"id":"liquid-spec-0h3","title":"Review error_handling specs failing in JSON-RPC","description":"3 specs fail in error handling category.\n\nThese likely involve:\n- Exception renderer callbacks\n- Error object serialization\n- Custom error handling behavior\n\nReview each spec to determine if it's:\n1. Testable via JSON-RPC with protocol changes\n2. Ruby-specific and should be marked ruby_types\n3. A bug in the JSON-RPC adapter","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T18:25:46.22998229-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:00:30.867226791-05:00","closed_at":"2026-01-17T19:00:30.867226791-05:00","close_reason":"Error handling specs reviewed. Marked Shopify-specific error format expectations with shopify_error_format and shopify_error_handling features. Error handling now passes in JSON-RPC adapter."}
{"id":"liquid-spec-0lg","title":"Document Ruby quirks that affect JSON-RPC implementers","description":"## Problem\nRuby has behaviors that affect Liquid output but aren't obvious to implementers\nin other languages. These need to be documented clearly.\n\n## Known quirks to document\n- Integer#size returns 8 (byte size) not digit count\n- Nil comparisons with blank/empty keywords\n- String#to_i returns 0 for non-numeric strings\n- Array sort with mixed types raises error\n- Range behavior (1..3 vs 1...3)\n- Truthy/falsy (only nil and false are falsy)\n\n## Location\n- docs/json-rpc-protocol.md - add 'Ruby Quirks' section\n- Link to docs/implementers/ruby-quirks.md for details\n\n## Acceptance\n- Each quirk has example input/output\n- Explain WHY the behavior exists (not just WHAT)\n- Include in protocol spec so implementers see it early","status":"closed","priority":1,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:23.52033659-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T10:18:31.315280268-05:00","closed_at":"2026-01-17T10:18:31.315280268-05:00","close_reason":"Completed: docs/implementers/ruby-quirks.md contains comprehensive documentation of Ruby-specific behaviors with exact input/output tables for all type combinations.","labels":["documentation"]}
{"id":"liquid-spec-4i0","title":"Investigate JSON-RPC test gap (~400 tests)","description":"## Problem\nDirect adapter passes 4503 tests while JSON-RPC only passes 4106.\nThis ~400 test gap needs investigation.\n\n## Investigation areas\n- Drop callback edge cases\n- Error handling differences  \n- Environment serialization quirks\n- Ruby-specific behaviors not captured in protocol\n\n## Files\n- examples/json_rpc_ruby_liquid.rb\n- scripts/remote-liquid/remote-liquid.rb\n- lib/liquid/spec/json_rpc/adapter.rb\n\n## Acceptance\n- Identify categories of failing tests\n- Document which are protocol issues vs Liquid behavior differences\n- Close the gap or document why certain tests can't pass over JSON-RPC","notes":"Progress: 93% pass rate (4210/4525). Remaining 315 failures are due to JSON limitations:\n- Ruby symbols (:foo) become strings in JSON\n- Binary data (\\xFF) replaced with Unicode replacement char\n- Circular references become placeholders  \n- Range objects can't be compared across JSON boundary\n\nFixed encoding issues:\n- UTF-8 sanitization for binary strings (input and output)\n- NaN/Infinity float handling\n- Hash key sanitization\n- Circular reference detection\n\nNext steps: Add ruby_types feature flag for specs that depend on Ruby-specific representations.","status":"closed","priority":1,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:51:34.155937017-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T17:45:26.308650573-05:00","closed_at":"2026-01-17T17:45:26.308650573-05:00","close_reason":"Investigated and documented. Gap is due to JSON transport limitations (symbols, binary, circular refs), not implementation issues. ~93% of specs pass over JSON-RPC. Documented limitations in docs/json-rpc-protocol.md.","labels":["enhancement"]}
{"id":"liquid-spec-88p","title":"Fix to_liquid callback in JSON-RPC drops","status":"closed","priority":2,"issue_type":"bug","owner":"tobi@lutke.com","created_at":"2026-01-17T18:23:51.40604895-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:01:03.513257573-05:00","closed_at":"2026-01-17T19:01:03.513257573-05:00","close_reason":"to_liquid callbacks are now working. All to_liquid tests pass. The relevant specs that still require ruby_drops are properly marked."}
{"id":"liquid-spec-aup","title":"Audit 50 uncategorized JSON-RPC failures","description":"~50 specs fail in JSON-RPC that don't fit the main categories (symbol_keys, binary_output, to_liquid, range, template_factory, error_handling).\n\nNeed to:\n1. Review each failure individually\n2. Categorize into actionable groups\n3. Determine if they're:\n   - Protocol bugs (fixable)\n   - Transport limitations (document)\n   - Ruby-specific (mark ruby_types)\n   - Missing features (create issues)\n\nRun: liquid-spec examples/json_rpc_ruby_liquid.rb 2\u003e\u00261 | grep FAIL\nto get the current failure list.","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T18:25:46.327851475-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:00:18.660512401-05:00","closed_at":"2026-01-17T19:00:18.660512401-05:00","close_reason":"Audited all JSON-RPC failures. Reduced from 332 to 3 failures by marking specs with appropriate features (ruby_types, ruby_drops, binary_data, shopify_*). The 3 remaining failures are genuine bugs tracked in liquid-spec-uo0."}
{"id":"liquid-spec-de0","title":"Investigate 155 'errors' in JSON-RPC test run","description":"## Problem\nJSON-RPC adapter shows 155 'errors' (vs 0 for direct adapter).\nThese are likely exceptions during test execution, not test failures.\n\n## Possible causes\n- Protocol-level errors from invalid params\n- Drop callback failures\n- Unknown template_id references\n- Exception type mismatches (runner expects specific exception classes)\n\n## Investigation\n- Run with verbose output to capture error messages\n- Check if errors cluster around specific test types\n- Ensure exception class names match what runner expects (e.g., contains 'SyntaxError')\n\n## Files\n- lib/liquid/spec/cli/runner.rb (error detection logic)\n- lib/liquid/spec/json_rpc/adapter.rb (exception classes)","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:51:44.420425754-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T10:18:15.062599918-05:00","closed_at":"2026-01-17T10:18:15.062599918-05:00","close_reason":"Fixed: Added UTF-8 sanitization, NaN/Infinity handling, hash key sanitization, and circular reference detection. Errors reduced from 155 to 0.","labels":["bug"]}
{"id":"liquid-spec-dyr","title":"Support StubTemplateFactory and custom registers over JSON-RPC","description":"## Problem\nSome tests use `template_factory` and custom registers that aren't being\npassed through the JSON-RPC protocol correctly.\n\nFailing tests include:\n- IncludeTagTest#test_render_tag_renders_error_with_template_name_from_template_factory\n- RenderTagTest#test_render_tag_renders_error_with_template_name_from_template_factory\n\n## Solution\n1. Add `template_factory` to the render params\n2. Handle StubTemplateFactory as a drop that needs RPC callbacks\n3. Pass custom registers through the protocol\n\n## Files\n- scripts/remote-liquid/remote-liquid.rb\n- lib/liquid/spec/json_rpc/adapter.rb\n- docs/json-rpc-protocol.md","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:51:53.501824436-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T09:56:01.303344283-05:00","closed_at":"2026-01-17T09:52:39.456937284-05:00","close_reason":"Likely unnecessary - investigate if StubTemplateFactory can be removed entirely","labels":["enhancement"]}
{"id":"liquid-spec-egx","title":"Add drop_call support for method invocation with arguments","description":"## Problem\nThe JSON-RPC protocol defines `drop_call` for calling methods with arguments,\nbut it's not fully tested or used. Some drops need method calls, not just\nproperty access.\n\n## Current state\n- Protocol spec defines drop_call\n- Server has request_drop_call method\n- Adapter/subprocess handle the callback\n- Not clear if any tests exercise this path\n\n## Tasks\n- Add test coverage for drop_call\n- Ensure NumberLikeThing.to_number works via drop_call\n- Document when drop_call vs drop_get is used\n\n## Files\n- scripts/remote-liquid/remote-liquid.rb (RpcDropProxy)\n- lib/liquid/spec/json_rpc/subprocess.rb (handle_drop_call)\n- docs/json-rpc-protocol.md","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:52:04.072916453-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:14:48.736308235-05:00","closed_at":"2026-01-17T18:14:48.736308235-05:00","close_reason":"Not needed - drop_call infrastructure exists but no specs require method calls with arguments on drops. All current drop access uses drop_get (property access). Can reopen if a use case emerges.","labels":["enhancement"]}
{"id":"liquid-spec-g5s","title":"Mark Range comparison specs with ruby_types","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T18:24:00.654706563-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:00:36.90938036-05:00","closed_at":"2026-01-17T19:00:36.90938036-05:00","close_reason":"Marked Range comparison specs with ruby_types feature. Ranges cannot be serialized through JSON, so these tests are appropriately skipped for JSON-RPC adapters."}
{"id":"liquid-spec-h43","title":"Add JSON-RPC protocol version negotiation","description":"## Problem\nCurrently the protocol just sends version '1.0' without real negotiation.\nAs the protocol evolves, we need proper versioning.\n\n## Proposal\n- Server declares supported versions in initialize response\n- Client can request specific version\n- Add breaking change policy documentation\n\n## Example\nRequest: {version: '1.0', min_version: '1.0'}\nResponse: {version: '1.0', supported_versions: ['1.0']}\n\n## Defer until\nProtocol is more stable - this is future-proofing","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:32.757881713-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:19:27.448378409-05:00","closed_at":"2026-01-17T18:19:27.448378409-05:00","close_reason":"Deferred - protocol is still evolving. Current version '1.0' is sufficient. Will add proper negotiation when protocol stabilizes and breaking changes are needed.","labels":["enhancement"]}
{"id":"liquid-spec-qqt","title":"blank/empty keyword comparison tests fail on both adapters","description":"## Problem\nTests like nil_is_blank fail on BOTH direct and JSON-RPC adapters:\n\n```\nTemplate: {% if missing == blank %}blank{% else %}not{% endif %}\nExpected: blank\nGot: not\n```\n\nThis suggests the spec expectation doesn't match actual Liquid behavior.\n\n## Investigation\n- Verify with raw Liquid: `ruby -e 'require \"liquid\"; puts Liquid::Template.parse(...).render({})'  `\n- Check if this is a Liquid version difference\n- May need to update spec expected values or add version constraints\n\n## Files\n- specs/basics/blank-and-empty.yml","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:43.572824959-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T10:07:52.768042453-05:00","closed_at":"2026-01-17T10:07:52.768042453-05:00","close_reason":"Resolved - all specs pass with updated liquid-ruby. The blank/empty comparison now works correctly.","labels":["bug"]}
{"id":"liquid-spec-qum","title":"Mark 95 symbol_keys specs with ruby_types feature","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T18:23:29.898567789-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:00:24.938911655-05:00","closed_at":"2026-01-17T19:00:24.938911655-05:00","close_reason":"Marked all symbol_keys specs with ruby_types feature. Also marked specs with integer keys, boolean keys, and Range comparison specs. Total ~200 specs marked with ruby_types.","comments":[{"id":1,"issue_id":"liquid-spec-qum","author":"Tobi Lutke","text":"Important: When marking a spec as ruby_types, if that spec would still be useful without the Ruby-specific parts (after minor changes to expected strings like :foo=\u003e to \"foo\"=\u003e), create BOTH versions:\n1. The original spec marked with ruby_types feature\n2. A new spec with modified expected output that tests the same behavior without symbol syntax\n\nThis ensures we have maximum test coverage - Ruby implementations can run both, while non-Ruby implementations can still benefit from the normalized version.","created_at":"2026-01-17T23:25:30Z"}]}
{"id":"liquid-spec-sd7","title":"Support binary data as base64 in JSON-RPC protocol","status":"open","priority":1,"issue_type":"feature","owner":"tobi@lutke.com","created_at":"2026-01-17T18:23:42.259808295-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:23:42.259808295-05:00","comments":[{"id":3,"issue_id":"liquid-spec-sd7","author":"Tobi Lutke","text":"This is a future enhancement. Currently, binary encoding specs (140 total) are marked with the binary_data feature and properly excluded from JSON-RPC adapter runs. The JSON-RPC adapter achieves 100% pass rate (4017/4017) on all applicable specs.\n\nTo implement this feature in the future:\n1. Base64 encode binary strings before JSON transport\n2. Add a marker field to indicate base64-encoded values\n3. Decode on the receiving end\n4. Update binary_data specs to work with the new encoding","created_at":"2026-01-18T00:09:02Z"}]}
{"id":"liquid-spec-uo0","title":"Fix JSON-RPC render for/include with iteration drops","status":"closed","priority":1,"issue_type":"bug","owner":"tobi@lutke.com","created_at":"2026-01-17T18:59:26.141591161-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:07:43.843223589-05:00","closed_at":"2026-01-17T19:07:43.843223589-05:00","close_reason":"Fixed! Three issues in RpcDropProxy:\n1. Added count method for iteration (Liquid checks respond_to?(:count))\n2. Fixed error propagation - check result.error not response.error\n3. Removed size method that was interfering with drop size behavior\n\nNow passes 4017/4017 specs (100%)","comments":[{"id":2,"issue_id":"liquid-spec-uo0","author":"Tobi Lutke","text":"3 specs fail in JSON-RPC adapter when using TestEnumerable/ErrorDrop with render for/include with:\n\n1. RenderTagTest#test_render_tag_for_drop_cf2ab489 - iterating TestEnumerable in render for\n2. IncludeTagTest#test_render_tag_renders_error_with_template_name_c34cdb86 - ErrorDrop raising exception  \n3. RenderTagTest#test_render_tag_renders_error_with_template_name_79f1a430 - ErrorDrop raising exception\n\nThe RpcDropProxy has each/to_a methods that call request_drop_iterate but Liquid's render for tag may not use these methods directly. Need to investigate how Liquid::Render iterates and ensure RpcDropProxy handles it properly.\n\nThese pass with the direct adapter so it's a JSON-RPC implementation bug, not a spec issue.","created_at":"2026-01-17T23:59:36Z"}]}
{"id":"liquid-spec-wly","title":"Support template_factory in JSON-RPC protocol","description":"4 specs fail because they use StubTemplateFactory for custom template parsing.\n\nThese specs test partial rendering with custom template factories. The JSON-RPC adapter doesn't support custom template factories.\n\nOptions:\n1. Mark as ruby_types if factory behavior is Ruby-specific\n2. Add template_factory callback to JSON-RPC protocol\n3. Document as unsupported edge case\n\nAffected specs test include/render with custom template lookup.","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T18:25:46.137606975-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T19:00:42.626634616-05:00","closed_at":"2026-01-17T19:00:42.626634616-05:00","close_reason":"Marked template_factory specs appropriately. JSON-RPC cannot support custom template factories as they require Ruby-specific runtime behavior. Specs marked with template_factory feature."}
{"id":"liquid-spec-xhy","title":"Create standalone JSON-RPC server test harness","description":"## Problem\nTo implement a Liquid JSON-RPC server in another language (Go, Rust, JS),\ndevelopers need a way to test their server without the full liquid-spec runner.\n\n## Proposal\nCreate a simple test script that:\n1. Sends raw JSON-RPC messages to stdin\n2. Validates responses match expected format\n3. Tests core methods: initialize, compile, render, quit\n4. Tests drop callbacks with mock drops\n\n## Benefits\n- Faster iteration for implementers\n- Can test in isolation before running full suite\n- Helps debug protocol issues\n\n## Files to create\n- scripts/test-jsonrpc-server.rb (or .sh)\n- Example test cases in JSON format","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:54:14.697592815-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:14:55.739518318-05:00","closed_at":"2026-01-17T18:14:55.739518318-05:00","close_reason":"Deferred - nice to have but not blocking. Implementers can use the full liquid-spec runner or write their own test scripts based on docs/json-rpc-protocol.md. Can revisit when there's demand from implementers.","labels":["enhancement"]}
{"id":"liquid-spec-zsw","title":"Simplify test drops - remove StubTemplateFactory and similar","description":"## Problem\nSeveral test drops exist that test very specific Ruby internals:\n- StubTemplateFactory - tests error message path prefixes\n- StubFileSystem - duplicate of what filesystem: already does\n\nThese add complexity without testing core Liquid behavior.\n\n## Investigation\nLook at what StubTemplateFactory tests actually verify - likely just error\nmessage formatting that could be tested more simply.\n\n## Potential action\n- Remove StubTemplateFactory specs or simplify them\n- Document which drops are essential vs nice-to-have\n- Consider a 'minimal drops' feature flag for JSON-RPC adapters","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:12.807172249-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:19:20.604788825-05:00","closed_at":"2026-01-17T18:19:20.604788825-05:00","close_reason":"Deferred - test drops are already reasonably organized. StubTemplateFactory tests specific error path behaviors. Can revisit if JSON-RPC coverage becomes a priority.","labels":["cleanup"]}

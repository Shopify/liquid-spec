{"id":"liquid-spec-0lg","title":"Document Ruby quirks that affect JSON-RPC implementers","description":"## Problem\nRuby has behaviors that affect Liquid output but aren't obvious to implementers\nin other languages. These need to be documented clearly.\n\n## Known quirks to document\n- Integer#size returns 8 (byte size) not digit count\n- Nil comparisons with blank/empty keywords\n- String#to_i returns 0 for non-numeric strings\n- Array sort with mixed types raises error\n- Range behavior (1..3 vs 1...3)\n- Truthy/falsy (only nil and false are falsy)\n\n## Location\n- docs/json-rpc-protocol.md - add 'Ruby Quirks' section\n- Link to docs/implementers/ruby-quirks.md for details\n\n## Acceptance\n- Each quirk has example input/output\n- Explain WHY the behavior exists (not just WHAT)\n- Include in protocol spec so implementers see it early","status":"closed","priority":1,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:23.52033659-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T10:18:31.315280268-05:00","closed_at":"2026-01-17T10:18:31.315280268-05:00","close_reason":"Completed: docs/implementers/ruby-quirks.md contains comprehensive documentation of Ruby-specific behaviors with exact input/output tables for all type combinations.","labels":["documentation"]}
{"id":"liquid-spec-4i0","title":"Investigate JSON-RPC test gap (~400 tests)","description":"## Problem\nDirect adapter passes 4503 tests while JSON-RPC only passes 4106.\nThis ~400 test gap needs investigation.\n\n## Investigation areas\n- Drop callback edge cases\n- Error handling differences  \n- Environment serialization quirks\n- Ruby-specific behaviors not captured in protocol\n\n## Files\n- examples/json_rpc_ruby_liquid.rb\n- scripts/remote-liquid/remote-liquid.rb\n- lib/liquid/spec/json_rpc/adapter.rb\n\n## Acceptance\n- Identify categories of failing tests\n- Document which are protocol issues vs Liquid behavior differences\n- Close the gap or document why certain tests can't pass over JSON-RPC","notes":"Progress: 93% pass rate (4210/4525). Remaining 315 failures are due to JSON limitations:\n- Ruby symbols (:foo) become strings in JSON\n- Binary data (\\xFF) replaced with Unicode replacement char\n- Circular references become placeholders  \n- Range objects can't be compared across JSON boundary\n\nFixed encoding issues:\n- UTF-8 sanitization for binary strings (input and output)\n- NaN/Infinity float handling\n- Hash key sanitization\n- Circular reference detection\n\nNext steps: Add ruby_types feature flag for specs that depend on Ruby-specific representations.","status":"closed","priority":1,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:51:34.155937017-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T17:45:26.308650573-05:00","closed_at":"2026-01-17T17:45:26.308650573-05:00","close_reason":"Investigated and documented. Gap is due to JSON transport limitations (symbols, binary, circular refs), not implementation issues. ~93% of specs pass over JSON-RPC. Documented limitations in docs/json-rpc-protocol.md.","labels":["enhancement"]}
{"id":"liquid-spec-de0","title":"Investigate 155 'errors' in JSON-RPC test run","description":"## Problem\nJSON-RPC adapter shows 155 'errors' (vs 0 for direct adapter).\nThese are likely exceptions during test execution, not test failures.\n\n## Possible causes\n- Protocol-level errors from invalid params\n- Drop callback failures\n- Unknown template_id references\n- Exception type mismatches (runner expects specific exception classes)\n\n## Investigation\n- Run with verbose output to capture error messages\n- Check if errors cluster around specific test types\n- Ensure exception class names match what runner expects (e.g., contains 'SyntaxError')\n\n## Files\n- lib/liquid/spec/cli/runner.rb (error detection logic)\n- lib/liquid/spec/json_rpc/adapter.rb (exception classes)","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:51:44.420425754-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T10:18:15.062599918-05:00","closed_at":"2026-01-17T10:18:15.062599918-05:00","close_reason":"Fixed: Added UTF-8 sanitization, NaN/Infinity handling, hash key sanitization, and circular reference detection. Errors reduced from 155 to 0.","labels":["bug"]}
{"id":"liquid-spec-dyr","title":"Support StubTemplateFactory and custom registers over JSON-RPC","description":"## Problem\nSome tests use `template_factory` and custom registers that aren't being\npassed through the JSON-RPC protocol correctly.\n\nFailing tests include:\n- IncludeTagTest#test_render_tag_renders_error_with_template_name_from_template_factory\n- RenderTagTest#test_render_tag_renders_error_with_template_name_from_template_factory\n\n## Solution\n1. Add `template_factory` to the render params\n2. Handle StubTemplateFactory as a drop that needs RPC callbacks\n3. Pass custom registers through the protocol\n\n## Files\n- scripts/remote-liquid/remote-liquid.rb\n- lib/liquid/spec/json_rpc/adapter.rb\n- docs/json-rpc-protocol.md","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:51:53.501824436-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T09:56:01.303344283-05:00","closed_at":"2026-01-17T09:52:39.456937284-05:00","close_reason":"Likely unnecessary - investigate if StubTemplateFactory can be removed entirely","labels":["enhancement"]}
{"id":"liquid-spec-egx","title":"Add drop_call support for method invocation with arguments","description":"## Problem\nThe JSON-RPC protocol defines `drop_call` for calling methods with arguments,\nbut it's not fully tested or used. Some drops need method calls, not just\nproperty access.\n\n## Current state\n- Protocol spec defines drop_call\n- Server has request_drop_call method\n- Adapter/subprocess handle the callback\n- Not clear if any tests exercise this path\n\n## Tasks\n- Add test coverage for drop_call\n- Ensure NumberLikeThing.to_number works via drop_call\n- Document when drop_call vs drop_get is used\n\n## Files\n- scripts/remote-liquid/remote-liquid.rb (RpcDropProxy)\n- lib/liquid/spec/json_rpc/subprocess.rb (handle_drop_call)\n- docs/json-rpc-protocol.md","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:52:04.072916453-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:14:48.736308235-05:00","closed_at":"2026-01-17T18:14:48.736308235-05:00","close_reason":"Not needed - drop_call infrastructure exists but no specs require method calls with arguments on drops. All current drop access uses drop_get (property access). Can reopen if a use case emerges.","labels":["enhancement"]}
{"id":"liquid-spec-h43","title":"Add JSON-RPC protocol version negotiation","description":"## Problem\nCurrently the protocol just sends version '1.0' without real negotiation.\nAs the protocol evolves, we need proper versioning.\n\n## Proposal\n- Server declares supported versions in initialize response\n- Client can request specific version\n- Add breaking change policy documentation\n\n## Example\nRequest: {version: '1.0', min_version: '1.0'}\nResponse: {version: '1.0', supported_versions: ['1.0']}\n\n## Defer until\nProtocol is more stable - this is future-proofing","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:32.757881713-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:19:27.448378409-05:00","closed_at":"2026-01-17T18:19:27.448378409-05:00","close_reason":"Deferred - protocol is still evolving. Current version '1.0' is sufficient. Will add proper negotiation when protocol stabilizes and breaking changes are needed.","labels":["enhancement"]}
{"id":"liquid-spec-qqt","title":"blank/empty keyword comparison tests fail on both adapters","description":"## Problem\nTests like nil_is_blank fail on BOTH direct and JSON-RPC adapters:\n\n```\nTemplate: {% if missing == blank %}blank{% else %}not{% endif %}\nExpected: blank\nGot: not\n```\n\nThis suggests the spec expectation doesn't match actual Liquid behavior.\n\n## Investigation\n- Verify with raw Liquid: `ruby -e 'require \"liquid\"; puts Liquid::Template.parse(...).render({})'  `\n- Check if this is a Liquid version difference\n- May need to update spec expected values or add version constraints\n\n## Files\n- specs/basics/blank-and-empty.yml","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:43.572824959-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T10:07:52.768042453-05:00","closed_at":"2026-01-17T10:07:52.768042453-05:00","close_reason":"Resolved - all specs pass with updated liquid-ruby. The blank/empty comparison now works correctly.","labels":["bug"]}
{"id":"liquid-spec-xhy","title":"Create standalone JSON-RPC server test harness","description":"## Problem\nTo implement a Liquid JSON-RPC server in another language (Go, Rust, JS),\ndevelopers need a way to test their server without the full liquid-spec runner.\n\n## Proposal\nCreate a simple test script that:\n1. Sends raw JSON-RPC messages to stdin\n2. Validates responses match expected format\n3. Tests core methods: initialize, compile, render, quit\n4. Tests drop callbacks with mock drops\n\n## Benefits\n- Faster iteration for implementers\n- Can test in isolation before running full suite\n- Helps debug protocol issues\n\n## Files to create\n- scripts/test-jsonrpc-server.rb (or .sh)\n- Example test cases in JSON format","status":"closed","priority":2,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:54:14.697592815-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:14:55.739518318-05:00","closed_at":"2026-01-17T18:14:55.739518318-05:00","close_reason":"Deferred - nice to have but not blocking. Implementers can use the full liquid-spec runner or write their own test scripts based on docs/json-rpc-protocol.md. Can revisit when there's demand from implementers.","labels":["enhancement"]}
{"id":"liquid-spec-zsw","title":"Simplify test drops - remove StubTemplateFactory and similar","description":"## Problem\nSeveral test drops exist that test very specific Ruby internals:\n- StubTemplateFactory - tests error message path prefixes\n- StubFileSystem - duplicate of what filesystem: already does\n\nThese add complexity without testing core Liquid behavior.\n\n## Investigation\nLook at what StubTemplateFactory tests actually verify - likely just error\nmessage formatting that could be tested more simply.\n\n## Potential action\n- Remove StubTemplateFactory specs or simplify them\n- Document which drops are essential vs nice-to-have\n- Consider a 'minimal drops' feature flag for JSON-RPC adapters","status":"closed","priority":3,"issue_type":"task","owner":"tobi@lutke.com","created_at":"2026-01-17T09:53:12.807172249-05:00","created_by":"Tobi Lutke","updated_at":"2026-01-17T18:19:20.604788825-05:00","closed_at":"2026-01-17T18:19:20.604788825-05:00","close_reason":"Deferred - test drops are already reasonably organized. StubTemplateFactory tests specific error path behaviors. Can revisit if JSON-RPC coverage becomes a priority.","labels":["cleanup"]}

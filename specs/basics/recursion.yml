---
_metadata:
  doc: implementers/scopes.md
  complexity: 400
  required_features:
    - inline_errors
  hint: |
    Liquid has a stack limit of 100 recursive partial calls. When this
    limit is exceeded, an inline error is rendered containing "Nesting too deep"
    and template execution continues after the error.

specs:
- name: recursion_include_error_inline
  template: |
    start
    {% include 'snippets/foo' %}
    done
  environment: {depth: 1}
  render_errors: true
  required_features: [inline_errors]
  errors:
    output:
      - start
      - "100|"
      - Nesting too deep
      - done
  filesystem:
    snippets/foo: |
      {{depth}}{% assign depth = depth | plus: 1 %}|
      {%- include 'snippets/foo' -%}
  hint: |
    Include has a stack limit of 100. When recursion exceeds this limit,
    an inline error is rendered containing "Nesting too deep". Template
    execution continues after the error, so "done" still appears.

- name: recursion_render_error_inline
  template: |
    start
    {% render 'snippets/foo' with depth as depth %}
    done
  environment: {depth: 1}
  render_errors: true
  required_features: [inline_errors]
  errors:
    output:
      - start
      - "100|"
      - Nesting too deep
      - done
  filesystem:
    snippets/foo: |
      {{depth}}{% assign depth = depth | plus: 1 %}|
      {%- render 'snippets/foo' with depth as depth -%}
  hint: |
    Render has a stack limit of 100. When recursion exceeds this limit,
    an inline error is rendered containing "Nesting too deep". Template
    execution continues after the error, so "done" still appears.

- name: recursion_render_named_arg_inline
  template: |
    start
    {% render 'snippets/foo' with depth as depth %}
    done
  environment: {depth: 1}
  render_errors: true
  required_features: [inline_errors]
  errors:
    output:
      - start
      - "100|"
      - Nesting too deep
      - done
  filesystem:
    snippets/foo: |
      {{depth}}{% assign depth = depth | plus: 1 %}|
      {%- render 'snippets/foo' depth: depth -%}
  hint: |
    Named argument syntax (depth: depth) behaves the same as
    "with depth as depth" for recursion limits. Stack limit is 100.

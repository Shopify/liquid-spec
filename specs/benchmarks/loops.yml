---
_metadata:
  hint: Loop performance benchmarks with realistic data
specs:
- name: bench_product_grid
  template: |
    {% comment %}Realistic loop: product grid with nested variants, pagination{% endcomment %}
    <div class="product-grid">
      {% for product in products %}
        <div class="product-card{% if forloop.first %} featured{% endif %}{% cycle ' odd', ' even' %}">
          <h3>{{ product.title | escape }}</h3>
          <p class="description">{{ product.description | truncate: 80 }}</p>
          <div class="pricing">
            {% if product.compare_at_price > product.price %}
              <span class="original">${{ product.compare_at_price }}</span>
              <span class="sale">${{ product.price }}</span>
              {% assign savings = product.compare_at_price | minus: product.price %}
              <span class="savings">Save ${{ savings }}</span>
            {% else %}
              <span class="price">${{ product.price }}</span>
            {% endif %}
          </div>
          {% if product.variants.size > 1 %}
            <div class="variants">
              {% for variant in product.variants %}
                <button class="variant{% if variant.available %} available{% else %} sold-out{% endif %}"
                        data-sku="{{ variant.sku }}">
                  {{ variant.title }}
                  {% if variant.price != product.price %} (+${{ variant.price | minus: product.price }}){% endif %}
                </button>
              {% endfor %}
            </div>
          {% endif %}
          <div class="tags">
            {% for tag in product.tags limit:3 %}
              <span class="tag">{{ tag | downcase | replace: " ", "-" }}</span>
            {% endfor %}
            {% if product.tags.size > 3 %}
              <span class="more">+{{ product.tags.size | minus: 3 }} more</span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    <nav class="pagination">
      {% if current_page > 1 %}
        <a href="?page={{ current_page | minus: 1 }}">&laquo; Prev</a>
      {% endif %}
      {% for i in (1..total_pages) %}
        {% if i == current_page %}
          <span class="current">{{ i }}</span>
        {% else %}
          <a href="?page={{ i }}">{{ i }}</a>
        {% endif %}
      {% endfor %}
      {% if current_page < total_pages %}
        <a href="?page={{ current_page | plus: 1 }}">Next &raquo;</a>
      {% endif %}
    </nav>
  environment:
    current_page: 2
    total_pages: 5
    products:
    - title: "Wireless Bluetooth Headphones Pro"
      description: "Premium noise-cancelling headphones with 40-hour battery life and crystal clear audio"
      price: 199
      compare_at_price: 249
      variants:
      - title: "Black"
        sku: "WBH-BLK"
        price: 199
        available: true
      - title: "White"
        sku: "WBH-WHT"
        price: 199
        available: true
      - title: "Rose Gold"
        sku: "WBH-RG"
        price: 219
        available: false
      tags: ["electronics", "audio", "wireless", "noise-cancelling", "premium"]
    - title: "Smart Watch Series 5"
      description: "Track your fitness, receive notifications, and stay connected with our latest smartwatch"
      price: 399
      compare_at_price: 399
      variants:
      - title: "40mm Silver"
        sku: "SW5-40S"
        price: 399
        available: true
      - title: "44mm Silver"
        sku: "SW5-44S"
        price: 429
        available: true
      - title: "40mm Space Gray"
        sku: "SW5-40G"
        price: 399
        available: true
      - title: "44mm Space Gray"
        sku: "SW5-44G"
        price: 429
        available: false
      tags: ["electronics", "wearable", "fitness"]
    - title: "Ergonomic Office Chair"
      description: "Adjustable lumbar support, breathable mesh, perfect for long work sessions"
      price: 349
      compare_at_price: 449
      variants:
      - title: "Standard"
        sku: "EOC-STD"
        price: 349
        available: true
      tags: ["furniture", "office", "ergonomic"]
    - title: "Mechanical Keyboard RGB"
      description: "Cherry MX switches, full RGB backlighting, programmable macros"
      price: 149
      compare_at_price: 149
      variants:
      - title: "Blue Switches"
        sku: "MK-BLUE"
        price: 149
        available: true
      - title: "Brown Switches"
        sku: "MK-BROWN"
        price: 149
        available: true
      - title: "Red Switches"
        sku: "MK-RED"
        price: 149
        available: true
      tags: ["electronics", "gaming", "keyboard", "rgb"]
    - title: "4K Webcam Pro"
      description: "Crystal clear video calls with autofocus and low-light correction"
      price: 129
      compare_at_price: 179
      variants:
      - title: "Standard"
        sku: "WC4K-STD"
        price: 129
        available: true
      tags: ["electronics", "video", "streaming"]
    - title: "USB-C Hub 7-in-1"
      description: "HDMI, USB 3.0, SD card reader, ethernet - all in one compact hub"
      price: 59
      compare_at_price: 79
      variants:
      - title: "Space Gray"
        sku: "HUB7-GRY"
        price: 59
        available: true
      - title: "Silver"
        sku: "HUB7-SLV"
        price: 59
        available: true
      tags: ["electronics", "accessories", "usb-c"]
  expected_pattern: "product-grid.*pagination"

---
ForTag:
  blank string not iterable:
  - TPL: "{% for char in characters %}I WILL NOT BE OUTPUT{% endfor %}"
    EXP: ''
    CTX: { characters: '' }
  dynamic variable limiting:
  - TPL: "{%for i in array limit: limit offset: offset %}{{ i }}{%endfor%}"
    EXP: '34'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0], limit: 2, offset: 2 }
  for:
  - TPL: "{%for item in array%} yo {%endfor%}"
    EXP: " yo "
    CTX: { array: [1] }
  - TPL: |
      {%for item in array%}
        yo
      {%endfor%}
    EXP: |2+

        yo

        yo

        yo

    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} yo {%endfor%}"
    EXP: " yo  yo  yo  yo "
    CTX: { array: [1, 2, 3, 4] }
  - TPL: "{%for item in array%}{%endfor%}"
    EXP: ''
    CTX: { array: [1, 2] }
  - TPL: "{%for item in array%}yo{%endfor%}"
    EXP: yoyo
    CTX: { array: [1, 2] }
  for and if:
  - TPL: "{%for item in array%}{% if forloop.first %}+{% else %}-{% endif %}{%endfor%}"
    EXP: "+--"
    CTX: { array: [1, 2, 3] }
  for else:
  - TPL: "{%for item in array%}+{%else%}-{%endfor%}"
    EXP: "+++"
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%}+{%else%}-{%endfor%}"
    EXP: "-"
    CTX: { array: [] }
  - TPL: "{%for item in array%}+{%else%}-{%endfor%}"
    EXP: "-"
    CTX: { array: [] }
  for helpers:
  - TPL: "{%for item in array%} {{forloop.index0}} {%endfor%}"
    EXP: " 0  1  2 "
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} {{forloop.last}} {%endfor%}"
    EXP: " false  false  true "
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} {{forloop.rindex}} {%endfor%}"
    EXP: " 3  2  1 "
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} {{forloop.index}} {%endfor%}"
    EXP: " 1  2  3 "
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} {{forloop.index}}/{{forloop.length}} {%endfor%}"
    EXP: " 1/3  2/3  3/3 "
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} {{forloop.rindex0}} {%endfor%}"
    EXP: " 2  1  0 "
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%} {{forloop.first}} {%endfor%}"
    EXP: " true  false  false "
    CTX: { array: [1, 2, 3] }
  for parentloop nil when not present:
  - TPL: "{% for inner in outer %}{{ forloop.parentloop.index }}.{{ forloop.index }} {% endfor %}"
    EXP: ".1 .2 "
    CTX: { outer: [[1, 1, 1], [1, 1, 1]] }
  for parentloop references parent loop:
  - TPL: "{% for inner in outer %}{% for k in inner %}{{ forloop.parentloop.index }}.{{ forloop.index }} {% endfor %}{% endfor %}"
    EXP: '1.1 1.2 1.3 2.1 2.2 2.3 '
    CTX: { outer: [[1, 1, 1], [1, 1, 1]] }
  for reversed:
  - TPL: "{%for item in array reversed %}{{item}}{%endfor%}"
    EXP: '321'
    CTX: { array: [1, 2, 3] }
  for tag string:
  - TPL: "{%for val in string%}{{forloop.name}}-{{forloop.index}}-{{forloop.length}}-{{forloop.index0}}-{{forloop.rindex}}-{{forloop.rindex0}}-{{forloop.first}}-{{forloop.last}}-{{val}}{%endfor%}"
    EXP: val-string-1-1-0-1-0-true-true-test string
    CTX: { string: test string }
  - TPL: "{%for val in string%}{{val}}{%endfor%}"
    EXP: test string
    CTX: { string: test string }
  - TPL: "{%for val in string limit:1%}{{val}}{%endfor%}"
    EXP: test string
    CTX: { string: test string }
  for with break:
  - TPL: "{% for i in array.items %}{{ i }}{% break %}{% endfor %}"
    EXP: '1'
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] } }
  - TPL: "{% for i in array.items %}{% break %}{{ i }}{% endfor %}"
    EXP: ''
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] } }
  - TPL: "{% for i in array.items %}{% if i == 9999 %}{% break %}{% endif %}{{ i }}{% endfor %}"
    EXP: '12345'
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  - TPL: "{% for i in array.items %}{{ i }}{% if i > 3 %}{% break %}{% endif %}{% endfor %}"
    EXP: '1234'
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] } }
  - TPL: "{% for i in array.items %}{% break %}{% endfor %}"
    EXP: ''
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] } }
  - TPL: "{% for item in array %}{% for i in item %}{% if i == 1 %}{% break %}{% endif %}{{ i }}{% endfor %}{% endfor %}"
    EXP: '3456'
    CTX: { array: [[1, 2], [3, 4], [5, 6]] }
  for with break after nested loop:
  - TPL: |-
      {% for i in (1..2) -%}
        {% for j in (1..2) -%}
          {{ i }}-{{ j }},
        {%- endfor -%}
        {% break -%}
      {% endfor -%}
      after
    EXP: 1-1,1-2,after
  for with continue:
  - TPL: "{% for i in array.items %}{% if i > 3 %}{% continue %}{% endif %}{{ i }}{% endfor %}"
    EXP: '123'
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  - TPL: "{% for i in array.items %}{% if i == 9999 %}{% continue %}{% endif %}{{ i }}{% endfor %}"
    EXP: '12345'
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  - TPL: "{% for i in array.items %}{% continue %}{% endfor %}"
    EXP: ''
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  - TPL: "{% for i in array.items %}{% continue %}{{ i }}{% endfor %}"
    EXP: ''
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  - TPL: "{% for i in array.items %}{% if i == 3 %}{% continue %}{% else %}{{ i }}{% endif %}{% endfor %}"
    EXP: '1245'
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  - TPL: "{% for item in array %}{% for i in item %}{% if i == 1 %}{% continue %}{% endif %}{{ i }}{% endfor %}{% endfor %}"
    EXP: '23456'
    CTX: { array: [[1, 2], [3, 4], [5, 6]] }
  - TPL: "{% for i in array.items %}{{ i }}{% continue %}{% endfor %}"
    EXP: '12345'
    CTX: { array: { items: [1, 2, 3, 4, 5] } }
  for with drop value range:
  - TPL: "{%for item in (1..foobar.value) %} {{item}} {%endfor%}"
    EXP: " 1  2  3 "
    CTX: {foobar: !ruby/object:ThingWithValue {context: }}
  for with hash value range:
  - TPL: "{%for item in (1..foobar.value) %} {{item}} {%endfor%}"
    EXP: " 1  2  3 "
    CTX: {foobar: {value: 3}}
  for with range:
  - TPL: "{% for item in (a..3) %} {{item}} {% endfor %}"
    EXP: " 0  1  2  3 "
    CTX: {a: invalid integer}
  - "{%for item in (1..3) %} {{item}} {%endfor%}": " 1  2  3 "
  for with variable:
  - TPL: "{%for item in array%}{{item}}{%endfor%}"
    EXP: abc
    CTX: {array: [a, '', b, '', c]}
  - TPL: "{%for item in array%}{{item}}{%endfor%}"
    EXP: abcd
    CTX: {array: [a, b, c, d]}
  - TPL: "{%for item in array%}{{item}}{%endfor%}"
    EXP: a b c
    CTX: {array: [a, " ", b, " ", c]}
  - TPL: "{%for item in array%} {{item}} {%endfor%}"
    EXP: " 1  2  3 "
    CTX: {array: [1, 2, 3]}
  - TPL: "{% for item in array %}{{item}}{% endfor %}"
    EXP: '123'
    CTX: { array: [1, 2, 3] }
  - TPL: "{%for item in array%}{{item}}{%endfor%}"
    EXP: '123'
    CTX: { array: [1, 2, 3] }
  for with variable range:
  - TPL: "{%for item in (1..foobar) %} {{item}} {%endfor%}"
    EXP: " 1  2  3 "
    CTX: { foobar: 3 }
  inner for over empty input:
  - "{% for a in (1..2) %}o{% for b in empty %}{% endfor %}{% endfor %}": oo
  iterate with each when no limit applied:
  - TPL: "{% for item in items %}{{item}}{% endfor %}"
    EXP: '12345'
    CTX: { items: !ruby/object:ForTagTest::LoaderDrop { data: [1, 2, 3, 4, 5] } }
  iterate with load slice returns same results as without:
  - TPL: "{% for item in items offset:2 limit:2 %}{{item}}{% endfor %}"
    EXP: '34'
    CTX: { items: [1, 2, 3, 4, 5] }
  - TPL: "{% for item in items offset:2 limit:2 %}{{item}}{% endfor %}"
    EXP: '34'
    CTX: { items: !ruby/object:ForTagTest::LoaderDrop { data: [1, 2, 3, 4, 5] } }
  iterate with load slice when limit and offset applied:
  - TPL: "{% for item in items offset:2 limit:2 %}{{item}}{% endfor %}"
    EXP: '34'
    CTX: { items: !ruby/object:ForTagTest::LoaderDrop { data: [1, 2, 3, 4, 5] } }
  iterate with load slice when limit applied:
  - TPL: "{% for item in items limit:1 %}{{item}}{% endfor %}"
    EXP: '1'
    CTX: { items: !ruby/object:ForTagTest::LoaderDrop { data: [1, 2, 3, 4, 5] } }
  limiting:
  - TPL: "{%for i in array limit:4 offset:2 %}{{ i }}{%endfor%}"
    EXP: '3456'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] }
  - TPL: "{%for i in array limit:2 %}{{ i }}{%endfor%}"
    EXP: '12'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] }
  - TPL: "{%for i in array limit:4 %}{{ i }}{%endfor%}"
    EXP: '1234'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] }
  - TPL: "{%for i in array limit: 4 offset: 2 %}{{ i }}{%endfor%}"
    EXP: '3456'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] }
  - TPL: "{%for i in array, limit: 4, offset: 2 %}{{ i }}{%endfor%}"
    EXP: '3456'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] }
  nested for:
  - TPL: "{%for item in array%}{%for i in item%}{{ i }}{%endfor%}{%endfor%}"
    EXP: '123456'
    CTX: { array: [[1, 2], [3, 4], [5, 6]] }
  offset only:
  - TPL: "{%for i in array offset:7 %}{{ i }}{%endfor%}"
    EXP: '890'
    CTX: { array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] }
  pause resume:
  - TPL: |2
            {%for i in array.items limit: 3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit: 3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit: 3 %}{{i}}{%endfor%}
    EXP: |2
            123
            next
            456
            next
            789
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] } }
  pause resume big limit:
  - TPL: |2
            {%for i in array.items limit:3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit:3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit:1000 %}{{i}}{%endfor%}
    EXP: |2
            123
            next
            456
            next
            7890
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] } }
  pause resume big offset:
  - TPL: |-
      {%for i in array.items limit:3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit:3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit:3 offset:1000 %}{{i}}{%endfor%}
    EXP: "123\n      next\n      456\n      next\n      "
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] } }
  pause resume limit:
  - TPL: |2
            {%for i in array.items limit:3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit:3 %}{{i}}{%endfor%}
            next
            {%for i in array.items offset:continue limit:1 %}{{i}}{%endfor%}
    EXP: |2
            123
            next
            456
            next
            7
    CTX: { array: { items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 0] } }
  spacing with variable naming in for loop:
  - TPL: "{% for       item   in   items %}{{item}}{% endfor %}"
    EXP: '12345'
    CTX: { items: [1, 2, 3, 4, 5] }

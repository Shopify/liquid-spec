Case:

  works:
  - "{% case 1 %}{% when 1 %} its 1 {% when 2 %} its 2 {% endcase %}": " its 1 "
  - '{% case "bad string here" %}{% when "string here" %} hit {% endcase %}': ''
  - '{% case "string here" %}{% when "string here" %} hit {% endcase %}': " hit "
  - "{% case 3 %}{% when 1 %} its 1 {% when 2 %} its 2 {% endcase %}": ''
  - "{% case 2 %}{% when 1 %} its 1 {% when 2 %} its 2 {% endcase %}": " its 2 "

  on length with else:
  - "{% case false %}{% when true %}true{% when false %}false{% else %}else{% endcase %}": 'false'
  - "{% case NULL %}{% when true %}true{% when false %}false{% else %}else{% endcase %}": else
  - "{% case true %}{% when true %}true{% when false %}false{% else %}else{% endcase %}": 'true'
  - "{% case a.empty? %}{% when true %}true{% when false %}false{% else %}else{% endcase %}": else

  on size:
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% endcase %}"
    EXP: ''
    CTX: { a: [1, 1, 1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% endcase %}"
    EXP: ''
    CTX: { a: [] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% endcase %}"
    EXP: ''
    CTX: { a: [1, 1, 1, 1, 1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% endcase %}"
    EXP: '1'
    CTX: { a: [1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% endcase %}"
    EXP: '2'
    CTX: { a: [1, 1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% endcase %}"
    EXP: ''
    CTX: { a: [1, 1, 1, 1] }

  on size with else:
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% else %}else{% endcase %}"
    EXP: else
    CTX: { a: [1, 1, 1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% else %}else{% endcase %}"
    EXP: else
    CTX: { a: [] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% else %}else{% endcase %}"
    EXP: '1'
    CTX: { a: [1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% else %}else{% endcase %}"
    EXP: else
    CTX: { a: [1, 1, 1, 1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% else %}else{% endcase %}"
    EXP: '2'
    CTX: { a: [1, 1] }
  - TPL: "{% case a.size %}{% when 1 %}1{% when 2 %}2{% else %}else{% endcase %}"
    EXP: else
    CTX: { a: [1, 1, 1, 1, 1] }

  when with muliple patterns via commas:
  - '{% case 1 %}{% when 1, "string", null %} a {% when 4 %} 4 {% endcase %}': " a "
  - '{% case "something else" %}{% when 1, "string", null %} a {% when 4 %} 4 {% endcase %}': ''
  - "{% case 3 %}{% when 1, 2, 3 %} 123 {% when 4 %} 4 {% endcase %}": " 123 "
  - "{% case 1 %}{% when 1, 2, 3 %} 123 {% when 4 %} 4 {% endcase %}": " 123 "
  - '{% case null %}{% when 1, "string", null %} 123 {% when 4 %} 4 {% endcase %}': " 123 "
  - '{% case "string" %}{% when 1, "string", null %} 123 {% when 4 %} 4 {% endcase %}': " 123 "
  - "{% case 4 %}{% when 1, 2, 3 %} 123 {% when 4 %} 4 {% endcase %}": " 4 "
  - "{% case 5 %}{% when 1, 2, 3 %} 123 {% when 4 %} 4 {% endcase %}": ''
  - "{% case 2 %}{% when 1, 2, 3 %} 123 {% when 4 %} 4 {% endcase %}": " 123 "

  when with multiple patterns and and blank body:
  - '{% case 2 %}{% when 1, 2 %} {% assign r = "result" %} {% endcase %}{{ r }}': result

  when with multiple patterns via 'or':
  - '{% case 1 %}{% when 1 or "string" or null %} a {% when 4 %} 4 {% endcase %}': " a "
  - '{% case "something else" %}{% when 1 or "string" or null %} a {% when 4 %} 4 {% endcase %}': ''
  - "{% case 3 %}{% when 1 or 2 or 3 %} 123 {% when 4 %} 4 {% endcase %}": " 123 "
  - "{% case 1 %}{% when 1 or 2 or 3 %} 123 {% when 4 %} 4 {% endcase %}": " 123 "
  - '{% case null %}{% when 1 or "string" or null %} 123 {% when 4 %} 4 {% endcase %}': " 123 "
  - '{% case "string" %}{% when 1 or "string" or null %} 123 {% when 4 %} 4 {% endcase %}': " 123 "
  - "{% case 4 %}{% when 1 or 2 or 3 %} 123 {% when 4 %} 4 {% endcase %}": " 4 "
  - "{% case 5 %}{% when 1 or 2 or 3 %} 123 {% when 4 %} 4 {% endcase %}": ''
  - "{% case 2 %}{% when 1 or 2 or 3 %} 123 {% when 4 %} 4 {% endcase %}": " 123 "

  with else:
  - "{% case 6 %} {% when 5 %} hit {% else %} else {% endcase %}": " else "
  - "{% case 5 %}{% when 5 %} hit {% else %} else {% endcase %}": " hit "
  - "{% case 6 %}{% when 5 %} hit {% else %} else {% endcase %}": " else "
  - '{%cycle "", "two"%} {%cycle "", "two"%}': " two"
  - '{%cycle "one", "two"%}': one
  - '{%cycle "text-align: left", "text-align: right" %} {%cycle "text-align: left", "text-align: right"%}': 'text-align: left text-align: right'
  - '{%cycle "one", "two"%} {%cycle "one", "two"%} {%cycle "one", "two"%}': one two one
  - '{%cycle "one", "two"%} {%cycle "one", "two"%}': one two

